# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cmake 1.0
PortGroup           github 1.0
PortGroup           cxx11 1.1
PortGroup           python 1.0

github.setup        MITHaystack digital_rf 2.6.0b1
name                digital_rf
version             2.6.0b1
maintainers         @MITHaystack {mit.edu:rvolz @ryanvolz} {mit.edu:swoboj @jswoboda}
description         Read, write, and interact with data in the Digital RF and Digital Metadata formats
categories          science
license             BSD
platforms           darwin
revision            0
dist_subdir         digital_rf

homepage            https://github.com/MITHaystack/digital_rf

checksums           rmd160  6382f310245ad7794107267a93378dfb2d53ab5f \
                    sha256  0475b5b33b192a42b7695923d98e9d18e7b410a7f967cffcc618de7ea7c7f88a

# dependencies
depends_lib  \
    port:uhd \
    port:boost \
    port:gnutls \
    port:gnuradio \
    port:py27-cheetah \
    port:python27 \
    port:py27-numpy \
    port:py27-pkgconfig \
    port:hdf5 \
    port:py27-packaging \
    port:py27-six \
    port:py27-tz \
    port:py27-watchdog

python.link_binaries \
  yes

# CMAKE configuration
configure.args-append \
    -DDRF_INSTALL_PREFIX_PYTHON=${python.prefix}
#    -DPYTHON_EXECUTABLE=${python.bin}
use_configure \
  yes
build.target \
  digital_rf_python
build.cmd \
  make
destroot.cmd \
  make
destroot.target \
  install
destroot.destdir \
  DESTDIR=${destroot}

# TODO Need to make this a for loop just inserting the links for now.
post-destroot {

  ln -s ${python.prefix}/bin/thor.py \
    ${destroot}${prefix}/bin/thor.py

  ln -s ${python.prefix}/bin/digital_metadata_archive.py \
    ${destroot}${prefix}/bin/digital_metadata_archive.py

  ln -s ${python.prefix}/bin/digital_rf_archive.py \
    ${destroot}${prefix}/bin/digital_rf_archive.py

  ln -s ${python.prefix}/bin/digital_rf_upconvert.py \
    ${destroot}${prefix}/bin/digital_rf_upconvert.py

  ln -s ${python.prefix}/bin/drf \
    ${destroot}${prefix}/bin/drf

  ln -s ${python.prefix}/bin/drf_cross_sti.py \
    ${destroot}${prefix}/bin/drf_cross_sti.py

  ln -s ${python.prefix}/bin/drf_plot.py \
    ${destroot}${prefix}/bin/drf_plot.py

  ln -s ${python.prefix}/bin/drf_sound.py \
    ${destroot}${prefix}/bin/drf_sound.py

  ln -s ${python.prefix}/bin/drf_sti.py \
    ${destroot}${prefix}/bin/drf_sti.py

  ln -s ${python.prefix}/bin/verify_digital_rf_upconvert.py \
    ${destroot}${prefix}/bin/verify_digital_rf_upconvert.py

}
