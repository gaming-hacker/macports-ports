# -*- coding: utf-8; mode: _tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- vim:fenc=utf-8:ft=tcl:et:sw=2:ts=2:sts=2

PortSystem          1.0
PortGroup           compilers 1.0
PortGroup user 1.0
name                gsl
version             2.5

categories          math science
maintainers         {dtakahashi @daitakahashi} openmaintainer
license             GPL-3+
homepage            https://www.gnu.org/software/gsl
description         A numerical library for C and C++ programmers
long_description    The GNU Scientific Library (GSL) is a numerical library  \
                    for C and C++ programmers.  It is free software under the \
                    GNU General Public License.  \
                    \
                    The library provides a wide range of mathematical routines \
                    such as random number generators, special functions and \
                    least-squares fitting. There are over 1000 functions in total.

master_sites        gnu
checksums           rmd160  2ec06d425adf5992191ff1c0dd992f3bae3af064 \
sha256  0460ad7c2542caaddc6729762952d345374784100223995eb14d614861f2258d \
size    7303881

platforms           darwin

use_parallel_build  yes

configure.args      --mandir=${prefix}/share/man --infodir=${prefix}/share/info
test.run            yes
test.target         check

post-activate    {
    system "install-info ${prefix}/share/info/gsl-ref.info ${prefix}/share/info/dir"
}

compilers.choose    cc
compilers.setup

if {[variant_isset doc_python27]} { set PythonVersion 27 }
if {[variant_isset doc_python36]} { set PythonVersion 36 }

variant doc_python27 conflicts doc_python36 description {Install PDF and HTML documentation using Python 2.7} {}
variant doc_python36 conflicts doc_python27 description {Install PDF and HTML documentation using Python 3.6} {}

if {[variant_isset doc_python27] || [variant_isset doc_python36] } {
    depends_build   port:ghostscript \
                    bin:latexmk:latexmk \
                    bin:latex:texlive \
                    port:texlive-latex-extra \
                    port:py${PythonVersion}-sphinx \
                    port:py${PythonVersion}-sphinx_rtd_theme \
                    port:py${PythonVersion}-sphinxcontrib-websupport

    ## for python>=3.5, typing has been installed as a standard library
    if {${PythonVersion} < 35} {
        depends_build-append port:py${PythonVersion}-typing
    }

    patchfiles-append patch-python_version.diff
    post-patch      {
        set PythonBranch [string range ${PythonVersion} 0 end-1].[string index ${PythonVersion} end]
        reinplace "s|__MACPORTS_SPHINX_BUILD__|sphinx-build-${PythonBranch}|g" ${worksrcpath}/doc/Makefile.in
    }
    post-build      {
        system -W ${worksrcpath}/doc "make latexpdf"
        system -W ${worksrcpath}/doc "make html"
    }
    post-destroot   {
        xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${name}
        xinstall -c -m 0644 ${worksrcpath}/doc/_build/latex/gsl-ref.pdf ${destroot}${prefix}/share/doc/${name}
        xinstall -d -m 0755 ${destroot}${prefix}/share/doc/${name}/
        copy ${worksrcpath}/doc/_build/html ${destroot}${prefix}/share/doc/${name}/
    }
}

livecheck.type  regex
livecheck.url   https://ftp.gnu.org/gnu/gsl/
livecheck.regex ${name}-(\[\\d.\]+)${extract.suffix}
