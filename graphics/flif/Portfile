# -*- coding: utf-8; mode: _tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 2 -*- vim:fenc=utf-8:filetype=tcl:et:sw=2:ts=2:sts=2

PortSystem      1.0
PortGroup       github 1.0

name                flif
version             0.3.0
revision            1
categories          graphics
license             LGPL
platforms           darwin
supported_archs     x86_64

set ver_clang "7.0"
set ver_perl "26"

github.setup        gaming-hacker FLIF d790731
version             20180213
fetch.type          git

maintainers         none
description         Free Lossless Image Format
long_description    FLIF is a lossless image format based \
                    on MANIAC compression. MANIAC (Meta-Adaptive Near-zero \
                    Integer Arithmetic Coding) is a variant of CABAC \
                    (context-adaptive binary arithmetic coding), where \
                    the contexts are nodes of decision trees which are \
                    dynamically learned at encode time. \
                    \
                    FLIF outperforms PNG, FFV1, lossless WebP, lossless \
                    BPG and lossless JPEG2000 in terms of compression ratio. \

configure.compiler  macports-clang-${ver_clang}

configure.ccache    no

use_configure       no

use_autoreconf      no

set FLAGS "-O3 -pipe -m64 -arch x86_64 -fopenmp -march=native -mtune=native -mmacosx-version-min=10.12 -fomit-frame-pointer -fno-common -mavx -mavx2 -mfma -mfpmath=sse -msse2 -msse3 -msse4.1 -msse4.2"

set WNO "-Wno-unknown-warning-option -Wno-unused-function -Wno-unused-variable -Wno-unused-command-line-argument -Wno-ignored-optimization-argument"

set MACROS "-DLEVEL1_DCACHE_LINESIZE=64 -DLEVEL1_DCACHE_SIZE=32 -DLEVEL2_DCACHE_SIZE=256 -DHASWELL -DL1_DATA_SIZE=32768 -DL1_DATA_LINESIZE=64 -DL2_SIZE=262144 -DL2_LINESIZE=64 -DDTB_DEFAULT_ENTRIES=64 -DDTB_SIZE=4096 -DHAVE_AVX -DHAVE_AVX2 -DHAVE_CFLUSH -DHAVE_CMOV -DHAVE_FMA3 -DHAVE_MMX -DHAVE_PSE -DHAVE_SSE -DHAVE_SSE2 -DHAVE_SSE3 -DHAVE_SSSE3 -DSSE4_1 -DHAVE_SSE4_2 -DHAVE_VFPV3 -DHAVE_OPENCL -D_REENTRANT -D_THREAD_SAFE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_NASM -DNDEBUG -DPIC -DUSE_PTHREAD"

configure.cc        ${prefix}/bin/clang-mp-${ver_clang}

configure.cflags    ${FLAGS} ${WNO} ${MACROS} -std=c11 -stdlib=libc++

configure.cxx       ${prefix}/bin/clang++-mp-${ver_clang}

configure.cxxflags  ${FLAGS} ${WNO} ${MACROS} -std=c++14 -stdlib=libc++

configure.cpp       ${prefix}/bin/clang-cpp-mp-${ver_clang}

configure.env       CC=${configure.cc} CFLAGS=${configure.cflags}

build.cmd               ${prefix}/bin/gmake
build.env               MAKE=${prefix}/bin/gmake
# build.args              CC=${configure.cc} CFLAGS=${configure.cflags}

depends_lib     port:libpng \
                port:libsdl2 \
                port:gdk-pixbuf2 \
                port:zimg \
                port:exif \
                port:libexif \
                port:p5.${ver_perl}-image-exiftool \
                port:gmake

depends_build-append          port:pkgconfig

livecheck.type      none
