# -*- coding: utf-8; mode: _tcl; tab-width: 2; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=2:ts=2:sts=2

PortSystem          1.0
PortGroup           github 1.0

name                daala
version             2.6.1
revision            0
epoch               1
categories          multimedia

maintainers         github:gaming-hacker

description         Daala next-generation video codec

long_description    Daala is the codename for a new video compression \
                    technology. The effort is a collaboration between \
                    the Mozilla Foundation, the Xiph.Org Foundation and \
                    any other contributors that wish to help. The goal of \
                    the project is to provide a video format that's free to\
                    implement, use and distribute, and a reference \
                    implementation with technical performance superior to \
                    H.265. For more information, see the Daala wiki.

homepage            https://xiph.org/daala/

platforms           darwin

supported_archs     x86_64

license             GPL

checksums           rmd160  ae9a2789247d075441191fec469a3a076d314c15

distname            ${name}

fetch.type          git
git.url             https://github.com/gaming-hacker/daala
git.branch          origin/v1
github.author       gaming-hacker
github.homepage     https://github.com/gaming-hacker/daala
github.tag_prefix   v1
github.master_sites https://github.com/gaming-hacker/daala
# depends_lib
use_configure       yes

set ver_clang "6.0"
set FLAGS "-O3 -pipe -m64 -arch x86_64 -fopenmp -march=native -mtune=native -mmacosx-version-min=10.12 -fomit-frame-pointer -fno-common -mavx -mavx2 -mfma -mfpmath=sse -msse2 -msse3 -msse4.1 -msse4.2"

set WNO "-Wno-unknown-warning-option -Wno-unused-function -Wno-unused-variable -Wno-unused-command-line-argument -Wno-ignored-optimization-argument"

set MACROS "-DLEVEL1_DCACHE_LINESIZE=64 -DLEVEL1_DCACHE_SIZE=32 -DLEVEL2_DCACHE_SIZE=256 -DHASWELL -DL1_DATA_SIZE=32768 -DL1_DATA_LINESIZE=64 -DL2_SIZE=262144 -DL2_LINESIZE=64 -DDTB_DEFAULT_ENTRIES=64 -DDTB_SIZE=4096 -DHAVE_AVX -DHAVE_AVX2 -DHAVE_CFLUSH -DHAVE_CMOV -DHAVE_FMA3 -DHAVE_MMX -DHAVE_PSE -DHAVE_SSE -DHAVE_SSE2 -DHAVE_SSE3 -DHAVE_SSSE3 -DSSE4_1 -DHAVE_SSE4_2 -DHAVE_VFPV3 -DHAVE_OPENCL -D_REENTRANT -D_THREAD_SAFE -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_NASM -DNDEBUG -DPIC -DUSE_PTHREAD"

configure.cc        ${prefix}/bin/clang-mp-6.0

configure.cflags    $FLAGS $WNO  $MACROS -std=c11 -stdlib=libc++

configure.cxx       ${prefix}/bin/clang++-mp-${ver_clang}

configure.cxxflags  $FLAGS $WNO  $MACROS -std=c++14 -stdlib=libc++

configure.cpp       ${prefix}/bin/clang-cpp-mp-${ver_clang}

set INTEL "/opt/intel/compilers_and_libraries_2018.0.104/mac"

configure.ldflags -L$INTEL/tbb/lib -L$INTEL/mkl/lib -L$INTEL/ipp/lib -L$INTEL/daal/lib -L/opt/local/libexec/llvm-${ver_clang}/lib -lc++ -lc++abi

configure.cppflags -I$INTEL/tbb/include -I$INTEL/mkl/include -I$INTEL/ipp/include -I$INTEL/daal/include -I/opt/local/libexec/llvm-${ver_clang}/include/c++/v1

configure.compiler  macports-clang-${ver_clang}

configure.ccache            no

use_autoreconf              yes
autoreconf.args             -fvi

set COMMON_ARGS "--quiet --disable-option-checking --disable-dependency-tracking --disable-maintainer-mode --enable-fast-install --enable-libtool-lock --disable-debug --disable-rpath --disable-nls --with-pic --enable-pic"

configure.args              $COMMON_ARGS \
                            --enable-asm \
                            --disable-unit-tests \
                            --enable-encoder-check \
                            --enable-float-pvq \
                            --disable-dct-check-overflow \
                            --enable-dump-images \
                            --enable-dump-recons \
                            --enable-dump-bsize-dist \
                            --enable-ec-accounting \
                            --enable-accounting \
                            --disable-analyzer \
                            --enable-player


livecheck.type      none
